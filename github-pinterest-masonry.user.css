/* ==UserStyle==
@name         GitHub README Pinterest Masonry
@namespace    github.com/tvgh/stylus-css
@version      1.0.0
@description  Pinterest-like masonry layout for image galleries in GitHub README
@author       tvgh
@license      MIT
@homepageURL  https://github.com/tvgh/stylus-css
@supportURL   https://github.com/tvgh/stylus-css/issues

@var range   columnCount     "列数 / Column Count"          [4, 2, 8, 1]
@var range   columnGap       "列间距 / Column Gap (px)"     [16, 4, 40, 2]
@var range   rowGap          "行间距 / Row Gap (px)"        [16, 4, 40, 2]
@var range   cardRadius      "卡片圆角 / Card Radius (px)"  [12, 0, 24, 2]
@var range   imageRadius     "图片圆角 / Image Radius (px)" [8, 0, 16, 2]
@var color   cardBg          "卡片背景 / Card Background"   #1a1a1a
@var color   pageBg          "页面背景 / Page Background"   #0d0d0d
@var range   hoverScale      "悬停缩放 / Hover Scale (%)"   [102, 100, 110, 1]
@var select  shadowStyle     "阴影样式 / Shadow Style"      {
  "无 None":       "none",
  "轻 Light":      "0 2px 8px rgba(0,0,0,0.2)",
  "中 Medium*":    "0 4px 12px rgba(0,0,0,0.3)",
  "重 Strong":     "0 6px 20px rgba(0,0,0,0.4)"
}
==/UserStyle== */

@-moz-document domain("github.com") {

  /* ========================================
     CSS Custom Properties (Runtime Variables)
     ======================================== */
  :root {
    /* Layout */
    --masonry-column-count: /*[[columnCount]]*/;
    --masonry-column-gap: /*[[columnGap]]*/px;
    --masonry-row-gap: /*[[rowGap]]*/px;
    
    /* Card Styling */
    --card-border-radius: /*[[cardRadius]]*/px;
    --card-background: /*[[cardBg]]*/;
    --card-shadow: /*[[shadowStyle]]*/;
    
    /* Image Styling */
    --image-border-radius: /*[[imageRadius]]*/px;
    --image-hover-scale: calc(/*[[hoverScale]]*/ / 100);
    
    /* Theme */
    --page-background: /*[[pageBg]]*/;
  }

  /* ========================================
     Page Background
     ======================================== */
  body,
  .application-main,
  .Layout,
  .Layout-main,
  .repository-content,
  #repo-content-pjax-container {
    background: var(--page-background) !important;
  }

  /* ========================================
     Masonry Container
     ======================================== */
  .markdown-body {
    column-count: var(--masonry-column-count) !important;
    column-gap: var(--masonry-column-gap) !important;
    padding: 16px !important;
    background: transparent !important;
    max-width: none !important;
  }

  /* ========================================
     Masonry Cards - Prevent Breaking
     ======================================== */
  .markdown-body > * {
    break-inside: avoid !important;
    -webkit-column-break-inside: avoid !important;
    page-break-inside: avoid !important;
  }

  /* ========================================
     Image-Containing Elements as Cards
     ======================================== */
  .markdown-body > div:has(img),
  .markdown-body > p:has(img),
  .markdown-body > ul:has(img),
  .markdown-body > ol:has(img),
  .markdown-body > li:has(img) {
    display: block !important;
    margin-bottom: var(--masonry-row-gap) !important;
    background: var(--card-background) !important;
    border-radius: var(--card-border-radius) !important;
    box-shadow: var(--card-shadow) !important;
    overflow: hidden !important;
    padding: 0 !important;
  }

  /* ========================================
     Hide Non-Image Elements
     ======================================== */
  
  /* Hide all headings */
  .markdown-body h1,
  .markdown-body h2,
  .markdown-body h3,
  .markdown-body h4,
  .markdown-body h5,
  .markdown-body h6 {
    display: none !important;
  }

  /* Hide code blocks but show prompt preview */
  .markdown-body pre,
  .markdown-body .highlight {
    display: block !important;
    max-height: 24px !important;
    overflow: hidden !important;
    background: transparent !important;
    border: none !important;
    padding: 4px 8px !important;
    margin: 4px 0 !important;
    font-size: 11px !important;
    color: rgba(255, 255, 255, 0.5) !important;
    white-space: nowrap !important;
    text-overflow: ellipsis !important;
  }

  .markdown-body pre code,
  .markdown-body .highlight code {
    display: inline-block !important;
    max-width: 120px !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    white-space: nowrap !important;
    background: transparent !important;
    padding: 0 !important;
  }

  .markdown-body .zeroclipboard-container {
    display: none !important;
  }

  /* Hide paragraphs without images */
  .markdown-body > p:not(:has(img)) {
    display: none !important;
  }

  /* Hide standalone text elements */
  .markdown-body > strong,
  .markdown-body > em,
  .markdown-body > blockquote,
  .markdown-body > hr {
    display: none !important;
  }

  /* Show prompt labels in image containers */
  .markdown-body > div:has(img) > strong,
  .markdown-body > div:has(img) > p > strong {
    display: block !important;
    font-size: 10px !important;
    color: rgba(255, 255, 255, 0.4) !important;
    padding: 4px 8px !important;
    margin: 0 !important;
    font-weight: normal !important;
  }

  /* Hide divs without images */
  .markdown-body > div:not(:has(img)) {
    display: none !important;
  }

  /* Hide text inside image containers but keep images */
  .markdown-body > div:has(img) > p:not(:has(img)):not(:has(strong)):not(:has(code)),
  .markdown-body > div:has(img) > br {
    display: none !important;
  }

  /* ========================================
     Override Inline Flex Containers
     ======================================== */
  .markdown-body div[style*="display: flex"],
  .markdown-body div[style*="display:flex"] {
    display: block !important;
    flex-direction: unset !important;
    justify-content: unset !important;
  }

  .markdown-body div[style*="display: flex"] img,
  .markdown-body div[style*="display:flex"] img {
    width: 100% !important;
    margin-bottom: 8px !important;
  }

  .markdown-body div[style*="display: flex"] img:last-child,
  .markdown-body div[style*="display:flex"] img:last-child {
    margin-bottom: 0 !important;
  }

  /* ========================================
     Image Styling
     ======================================== */
  .markdown-body img {
    width: 100% !important;
    height: auto !important;
    max-width: 100% !important;
    border-radius: var(--image-border-radius) !important;
    display: block !important;
    object-fit: cover !important;
    transition: transform 0.3s ease, box-shadow 0.3s ease !important;
  }

  /* Hover Effect */
  .markdown-body img:hover {
    transform: scale(var(--image-hover-scale)) !important;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4) !important;
    z-index: 10 !important;
    position: relative !important;
  }

  /* Override inline width styles on images */
  .markdown-body img[style*="width"] {
    width: 100% !important;
  }

  /* ========================================
     List Items with Images
     ======================================== */
  .markdown-body ul:has(img),
  .markdown-body ol:has(img) {
    list-style: none !important;
    padding-left: 0 !important;
    margin: 0 !important;
  }

  .markdown-body li:has(img) {
    list-style: none !important;
    margin-bottom: var(--masonry-row-gap) !important;
    background: var(--card-background) !important;
    border-radius: var(--card-border-radius) !important;
    box-shadow: var(--card-shadow) !important;
    overflow: hidden !important;
  }

  /* Hide text in list items, keep images */
  .markdown-body li:has(img) > *:not(img):not(a:has(img)) {
    display: none !important;
  }

  .markdown-body li:has(img) a:has(img) {
    display: block !important;
  }

  /* ========================================
     Responsive Columns
     ======================================== */
  @media screen and (max-width: 768px) {
    .markdown-body {
      column-count: max(1, calc(var(--masonry-column-count) - 2)) !important;
    }
  }

  @media screen and (min-width: 769px) and (max-width: 1024px) {
    .markdown-body {
      column-count: max(2, calc(var(--masonry-column-count) - 1)) !important;
    }
  }

  /* ========================================
     GitHub Lazy Loading Support
     ======================================== */
  .markdown-body img[loading="lazy"] {
    min-height: 100px !important;
    background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%) !important;
  }

  /* ========================================
     Hide GitHub README Header & Borders
     ======================================== */
  #readme .Box-header,
  #readme .Box-body > .markdown-body::before,
  .Box.Box--condensed {
    display: none !important;
  }

  #readme .Box,
  #readme .Box-body {
    border: none !important;
    background: transparent !important;
  }

}
